<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lista de Manutenções</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-primary">
  <main class="container py-4">
    <h1 class="mb-4 fw-bold text-center text-white">🛠️ Lista de Manutenções 🛠️</h1>

    <form class="d-flex mb-3" th:action="@{/manutencao/procurar}" method="get">
      <input class="form-control form-control-lg me-2 rounded-pill shadow-sm" type="search" name="titulo"
        placeholder="Buscar por manutenção">
      <button class="btn btn-success btn-lg rounded-pill shadow-sm" type="submit">Buscar</button>
    </form>

    <p th:if="${errorA}" class="text-danger" th:text="${errorA}"></p>

    <a th:href="@{manutencao/criar}" class="btn btn-success btn-lg rounded-pill shadow m-3">Nova Tarefa</a>

    <div class="table-responsive shadow-sm rounded overflow-hidden">
      <table class="table table-hover table-striped table-bordered fs-5 fw-bold mb-0" th:unless="${#lists.isEmpty(manuts)}">
        <thead class="table-primary">
          <tr>
            <th>ID</th>
            <th>Manutenção</th>
            <th>Solicitante</th>
            <th>Descrição</th>
            <th>Criado em</th>
            <th>Finalizado em</th>
            <th>Urgência</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="manut : ${manuts}" style="vertical-align: middle;">
            <th th:text="${manut.id}">---</th>
            <td th:text="${manut.titulo}">---</td>
            <td th:text="${manut.nome}">---</td>
            <td th:text="${manut.descricao}" style="max-width: 300px; white-space: normal; word-wrap: break-word;">---</td>
            <td th:text="${#temporals.format(manut.criadoEm)}">---</td>
            <td th:text="${manut.finalizadoEm != null ? #temporals.format(manut.finalizadoEm) : '-'}">---</td>
            <td>
              <span th:text="${manut.urgente} ? 'Urgente' : 'Não Urgente'" 
                    th:classappend="${manut.urgente} ? 'badge bg-danger' : 'badge bg-success'">
              </span>
            </td>
            <td class="d-flex gap-2 flex-wrap">
              <form th:action="@{/manutencao/finalizar/{id}(id=${manut.id})}" method="post" class="w-100">
                <button type="submit" class="btn btn-success btn-sm rounded-pill w-100"
                  th:classappend="${manut.finalizadoEm} ?'disabled':''">Concluir</button>
              </form>

              <a th:href="@{/manutencao/editar/{id}(id=${manut.id})}"
                 class="btn btn-warning btn-sm text-white rounded-pill w-100"
                 th:classappend="${manut.finalizadoEm} ?'disabled':''">Editar</a>

              <a th:href="@{/manutencao/deletar/{id}(id=${manut.id})}"
                 class="btn btn-danger btn-sm rounded-pill w-100">Excluir</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <p th:if="${#lists.isEmpty(manuts)}"
       class="bg-danger bg-opacity-60 text-white p-2 rounded text-center fw-bold mt-3">
      Nenhuma Tarefa Cadastrada
    </p>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
